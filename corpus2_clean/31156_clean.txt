far tighter version previous question asked problem collect collect exp pattern simplify simplify coefficient nothing matched pattern one call fullsimplify result collection frequently undos collect especially important collecting matching complicated non integer exponent exponential solve think following solution way could lose part expression tree transformation collectfullsimplifyimpl exp pat matchq pat fullsimplify collect exp pat fullsimplify collectfullsimplify exp pat fixedpoint collectfullsimplifyimpl pat exp think want depth first mapall simplify expression bottom recursive ensure undo previous collection go e calling fullsimplify higher level node could mean lower node longer match pattern fixed point want allow recollection simplification exponent simplified could combined trouble finding minimal example might unncessary see result try following test exp b b x b b x b x exp b b x b b x x b b x x b b test recursion print collect collect simplification collectfullsimplify collect exp x collect exp x fullsimplify collectfullsimplify exp x print collect collect simplification collectfullsimplify collect exp x collect exp x fullsimplify collectfullsimplify exp x following output collect collect simplification collectfullsimplify x b x b b x b b b x x b b x b x evaluation collect collect simplification collectfullsimplify x b b x x b b x x b b x b b x x b b x x b b x b x one problem found following collectfullsimplifyimpl v l z z becomes v l pattern matchq z blank fullsimplify z blank ugly since commonly want call collectfullsimplify rule form v l z complicated stuff wreck