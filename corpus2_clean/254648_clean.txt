following test routine called dll work fine release throw caused call calling somehow changed handle feel memory problem far fix found take copy handle use close handle call trimmed minimum including ip address integer num num little endian wrong tested problem num xe2 problem idea unit interface us window message sysutils variant class graphic control form dialog winapi window winapi message system sysutils system variant system class vcl graphic vcl control vcl form vcl dialog vcl packed record b1 b2 b3 b4 byte end packed record w1 w2 word end record case integer num un b num un w num addr end echo reply echo reply echo reply packed record address status ulong ulong datasize word reserved word pointer end pip option information ip option information ip option information packed record ttl byte tos byte flag byte byte pointer end button2 procedure sender tobject private private declaration public public declaration end hwnd stdcall external dll const hwnd stdcall external dll const hwnd const const pointer const word const pip option information const pointer const dword const timeout dword dword stdcall external dll var implementation r dfm boolean var dword dw dword echo reply hwnd hwnd begin result invalid handle begin try sizeof echo reply num addr num num showmessage format num x dw nil num nil num showmessage format num x result status num finally try except e exception showmessage e message end end end end procedure sender tobject begin showmessage byte end end