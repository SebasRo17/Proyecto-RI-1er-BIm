accident found polymorphic using dynamic cast back derived throw bad cast pointer longer valid undefined behavior could way check valid pointer without using smart pointer really using smart pointer serve real need dislike syntax anything templated type find smart pointer bloat fan macro try avoid bloat wish c included something language syntax v using template feature question concerned happening valid defined way checking valid pointer give exception every time test include include map using namespace std base public virtual base derived public base public virtual derived storage private map base storage public additem base base storage find storage end storage base template storage find storage end base item storage dynamic cast item throw storage store force go scope test derived store additem test throw bad cast exception derived test store derived test num