part program repeatedly call many time time f reap sow nparticle vir hl l e dr r r j dr map hl l hl l dr r dot dr dr r rc r r e r r r ecut valuef r r r df dr valuef r f df f j df vir valuef r rc gr integerpart sqrt r dh j nparticle nparticle r list form hl l rc parameter initialize start way optimize code like using compile parallelization tried always getting various kind error wrong calculation two loop avoidable case requested value parameter rc rc rc nparticle rho l nparticle rho hl l rr rc ecut rr rr initialization r lincell round nparticle lattconst l lincell r reap sow ix iy iz lattconst sow ix iy iz lattconst sow ix iy iz lattconst sow ix iy iz lattconst iz lincell iy lincell ix lincell edit need add output program r rc gr integerpart sqrt r dh added inner loop modified code gr initialized dh