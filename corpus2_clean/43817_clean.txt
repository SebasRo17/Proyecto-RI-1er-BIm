following code take second run one suggestion make expression qf phi qr k efficient someone suggest way use nestwhile place compile four expression qf phi qr k enable parallelization demand n k min k vf n capacity supply n k min n kj k w n capacity flo n ku kd min demand n ku supply n kd gamma ku kd min supply l kd demand l ku inflow phi fqin phi beta fqin dx density qin qout qr qin qout qr vf l beta dx capacity kj w vf tt rml k table kr table table tt qf map flo l partition k phi flatten map demand take kr map gamma partition k qr inflow transpose phi qf k plus transpose insert map density flatten transpose partition qf qr k k k tt plus k timing edit also following piece code go right k k code rmori table dx dx n rm mapthread min rmori flo rml rml kr qr mapthread join flo l partition rml kr rm flo l partition rml kr phi kr mapthread join density rest qr kr line suggestion made simonwoods one suggest way improve piece code also need guidance using nestwhile place