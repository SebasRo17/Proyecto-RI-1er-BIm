suppose building json api would like include endpoint return list recently created post somewhere system existing post model following test create post db new old post post recent assert post contains new post want test drive json endpoint wrapping functionality controller obvious way test would full integration test like create post db new old make request post assert new post returned response seems duplicate much already tested model start slow test suite path need tested e auth query params etc alternative num mock model mock post recent make request post assert post recent called num stub model stub post recent make request post assert stubbed post response either one option alone seem sufficient fully test controller combined seems fairly comprehensive piece remains untested agreement model controller post recent decide refactor model model test post recent longer exists test still pas even though production system fail one address integration test answer bother stubbing mocking