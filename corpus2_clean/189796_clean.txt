currently implementing undo redo mechanism using command pattern everything work far problem implement undo redo functionality way bound given context assume following situation execute action1 switch execute action2 undo stack would look follows action2 action1 happens get closed removed start performing undos action1 program would probably crash context executed previously e exist get closed corresponding action removed undo stack question whether exist already implementation best practice implementing scenario properly idea