trying evaluate double integral performance issue first bit math using galerkin like scheme discretize operator equation working problem trying solve start hat function x psi j z left begin array frac delta z z z j z z j frac delta z z z j z z j left vert z z j right vert delta z end array right psi left begin array frac delta frac delta left vert right vert delta end array right j correspond node grid define arbitrary function variable interest pressure case theta z cong sum limit sum limit j theta ij psi psi j z p z cong sum limit sum limit j p ij psi psi j z arbitrary function corresponds coefficient operator approximating integral trying solve theta p z z cong frac int int psi psi j theta p dz dy int int psi psi j dz dy code building done earlier piecewise function zt z c piecewise z c z z c z c z z c z z c piecewise zt z c zt z c zt z c yt c piecewise c c c c c piecewise yt c yt c yt c function defined expand double sum z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z subscript j subscript z z subscript z note use mu represent p assumption make basisassumy subscript real real real subscript real subscript real subscript subscript subscript subscript subscript subscript subscript subscript subscript assumption made z direction basisrulesall subscript z subscript z z subscript z subscript z z subscript z subscript z z subscript subscript subscript subscript subscript subscript integrating procedure simplify integrate integrate z z subscript z z z z subscript z subscript z assumption basisassumz subscript subscript subscript assumption basisassumy z basisrulesall run hour without returning result contrast done similar calculation get notebook take second manage get integral evaluate remove term x integral grouped together like term factored integral took second evaluated messy cannot sure human error introduced would simpler method worked reasonable amount time anyone suggestion could improve performance double integration