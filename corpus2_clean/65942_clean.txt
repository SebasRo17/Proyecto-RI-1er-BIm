following statement question describes something may pattern question known pattern situation iterate two dissimilar multi layer structure copy information one depending particular use case around eight different kind layer combined eight different combination b c b c c e e unsuccessful attempt factor repetition per layer iteration realized key difficulty refactoring fact bottom level needed access gathered higher level explicitly accommodate requirement introduced number get set method accumulating necessary information end following structure iterator virtual const structure ctx const num public iterator const iterator public virtual const structure ctx const iterate member locate corresponding item passed via context set context invoke sub iterator public virtual const structure ctx const iterate member form context set item context locate corresponding item passed via context invoke sub iterator public iterator virtual const structure ctx const copy structure num structure num context using higher level needed ctx iterate ctx happens uniform structure similar xml dom respect legacy structure made various struct array allows pas outside context convenience general either side iteration side may passed via context convenient key situation point complicated need invoked layer multiple combination layer type possible bottom layer information top layer need visible key implementation point use context access level iteration complicated iteration encapsulated implementation pure virtual two interface one aware underlying iterator one aware use const simplify usage syntax