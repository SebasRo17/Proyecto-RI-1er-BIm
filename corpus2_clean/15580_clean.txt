trying speed function look neighborhood point large dataset find point within unit direction x z started using select find point around specified point map function dataset first let make data define findpoints function data randomreal findpoints data pt block x pt pt z pt select data x x z z let map random data map findpoints data data absolutetiming quite slow gave waiting started compiling findpoint function findpointsc compile data real pt real block x pt pt z pt select data x x z z compilationtarget c runtimeattributes listable parallelization true runtimeoptions speed output map findpointsc data data absolutetiming null much faster great figured since compiling beneficial function found compiling map function gain speed let compile whole thing mapfindpointsc compile data real map findpointsc data data compilationtarget c runtimeattributes listable parallelization true runtimeoptions speed mapfindpointsc data compiledfunction cflist nontensor object generated proceeding uncompiled evaluation however per error message case output ragged tensorq output false tried flatten output map nothing think work possible compile expression