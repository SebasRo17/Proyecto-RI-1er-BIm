trying perform neighborhood analysis image imagefilter seems interfering result outputted provided filtering function initialization given hue channel image image import hue colorseparate image hsb see information hidden dark area imageadjust hue processing intent replace value every pixel value variance direct x neighbor huevar imagefilter composition variance flatten hue result also dark expected dark area effectively black clipped result expected filter output small value could observe following reap huevar imagefilter composition sow variance flatten hue reapvar reapvar take flatten imagedata huevar take reconstruct image data reapvar get exactly want dark image scaled show detail dark area image partition reapvar first imagedimensions image imageadjust pre mid scaling also tried pre scaling output directly filtering function reap scaledhuevar imagefilter composition sow variance flatten hue scaledreapvar dark area get brighter way precise value even bright area different obtained sowing reaping scaledreapvar take flatten imagedata scaledhuevar take causing difference result clipping occurring