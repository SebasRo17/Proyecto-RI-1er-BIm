third time write software control cellular modem unfamiliar process sequence step take step take certain amount time response receive amount time also response receive time regardless step based response go another stage process time go different stage case step attempted multiple time going another stage non blocking function task single threaded machine program would calling hundred time second check whether need something performs needed exit past written simple switch based state machine enumerated stage somewhat like following switch stage case power poweron turn modem go perform reset num send reset command five time break case modem write n reset use one attempt next wait response ok timeout millis num wait num second attempt break case ok success attach cellular network elseif timeout millis get timeout power num else power break case stage assign stage indirectly purpose nice know came point difficult keep track whole flow system inserting additional step requires change step seems like easier way largest one design fewer num stage unmanageable help think better strategy pattern work use define timeouts attempt would bit nicer embedded state machine perhaps structure sort could made hold state since response vary seems complicated step simple ok contain status acted stage change based exact response