need generate large sparse block matrix block consisting one along diagonal tried several way seem always run memory fastest way come far follows typically need n least order tmp sparsearray n n sparsearray arrayflatten table j tmp j example n matrix problem construction arrayflatten reason convert result normal matrix run memory work code computes end result quickly result take much memory specific number however suddenly crash intermediate arrayflatten step clog memory help greatly appreciated