write c striving write testable little confused deciding writing pure function really good testing require smaller function hurt readability opinion writing function modify internal state example state variable declared static hence private module testable opinion outer api bar modify internal state internal foo internal foo stuff internal state stuff internal state outer api bar modify internal state internal foo internal state could another repeated many time module internal state internal state internal foo bool arg stuff arg stuff although second implementation testable wrt internal foo make bar uglier requires smaller function make hard reader even follow small snippet constantly shift attention different function one think better compare writing oops private function time use internal state pure testing done setting internal state mock instance testing private getting little confused whether use whether pas internal state private function sake testability