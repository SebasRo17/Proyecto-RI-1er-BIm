want make list chemical reaction write require mhchem latex format following form na n mb j rightarrow hat na hat n hat hat hat hat j relevant part na n mb j depends parameter b n n j e atomar specie quantity n number element molecule n index modi like excitation ionization like e g cf cf cl want create object function reaction b n n j k value k k evaluates tex form na n mb j k string information tricky part k give list permissible product reaction amount implement conservation atomar specie ce legal think n n const bound charge conservation know totexform function open optimization problem easy handle would go solving guess combinatorial problem mathematica want write subroutine get called function method add value k afterwards e want add information later updating k string amount redefining string reaction new information see thinking object oriented point view might wrong last step would also take account object like cf ch decompose e g cf c cf h enough progress tex n n q head list tex n tex tex n tex q tostring n tostring tostring n tostring q tex b c tex tex b tex c tex q e head q list tex q tex e tostring q tostring e tex tex example tex ch tex h enter image description norm n n q n n q norm n n q norm n n q norm n n q b p b n n q p n n q p b norm n n q q e n n q q norm n n q b p q e b n n q p q n n q p q b summands int table int index index index floor int divisor int int divisor int split first last summands shift first last divisor multiplytemp term flatten map table ind ind ind length ind length map shift split norm term multiply term map function termvar select termvar deleteduplicates multiplytemp term reverse product length norm multiply length norm flatten table flatten ind ind ind length first ind length last multiply example myterm ch tex myterm longrightarrow tex product myterm tableform enter image description myterm h tex myterm longrightarrow tex product myterm tableform enter image description elaboration realized going generate possible outcome reaction based atomic specie number charge conservation general expression na n qe normalized n cdot n q generation generalizes na n qe na n mb qe ne b clause code result special treatment ne b firstly normalize norm generate possible decomposition split n cdot n rightarrow n cdot n k ka generate combination ka k k cdot k n cdot n function shift multiply multiplytemp result pre filter deletion expression k dublicates open suggestion regarding code stick reaction integer coefficient case one want generalize one would change shift function something else next step charge conservation shift total charge expression easy read guess make sense define global variable ionizationlevel usually set since higher ionization common take every list product generate couple new list consisting specie charge shifted around specie well possible freed electron q e manybe come question putting specie together give lot new option course idea implement