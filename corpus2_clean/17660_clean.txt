seems basic necessity language pattern matching capability mathematica yet struggled many hour find common solution problem suppose pattern sub element named expression match generate list replacement rule map sub element name value matching expression e g patt f x expr ab c e f mkmatchrules expr patt f ab x sequence e f written solution collectallpattvars patt union map part case patt pattern infinity head true mkmatchrules expr patt module pattvars collectallpattvars patt mkrhs mkrhs block releasehold hold patt map list pattvars matchq expr patt mapthread rule length sequence pattvars replace expr mkrhs failed produce result example however hope somebody know elegant way