trying build time dependent schrodinger equation solver using crank nicholson method think code kind working speed still slow code calculates wave function psi x certain time given initial wave function psi x position dependent potential v x tdse v function ct xmin xmax tmin tmax dt module tmtx vmtx hmtx ct cl dx tl xl n grid length ct dx xmax xmin n grid xl range xmin xmax dx tl range tmin dt tmax dt tmtx dx sparsearray j ab j n grid n grid kinetic energy sparsearray n grid n grid identity matrix ct ct vmtx sparsearray band v xl potential energy hmtx tmtx vmtx total hamiltonian cl table ct linearsolve hmtx dt hmtx dt ct tl cl example calculating wave function using solver ct array exp n initial wave function cl tdse function x x ct absolutetiming null listplot cl joined true plotrange enter image description pretty satisfied speed however interested time dependent potential ie v v x time independent one changed code little bit every time step recalculates potential vmtx time tdse v function ct xmin xmax tmin tmax dt module tmtx vmtx hmtx ct cl dx tl xl n grid length ct dx xmax xmin n grid xl range xmin xmax dx tl range tmin dt tmax dt tmtx dx sparsearray j ab j n grid n grid sparsearray n grid n grid ct ct cl table vmtx sparsearray band v xl hmtx tmtx vmtx ct linearsolve hmtx dt hmtx dt ct tl cl function call also changed slitly cl tdse function function x x ct absolutetiming null x slower tried compile function inside module replacing vmtx line something like vmtx sparsearray band vcpf xl vcpf compiled function defined vcpf compile real x real v x runtimeattributes listable make problem even worse x slower tdse question possible speed tdse get speed tdse even faster