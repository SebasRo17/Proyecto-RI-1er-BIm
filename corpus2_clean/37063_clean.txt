context developing software reproduce functionality window home server drive user use multiple hard disk prevent loss software exists since dec num issue renames detailed directory dira user work create modify rename delete file sub dira want keep another directory sync dira goal backup file dira case drive fails would another drive like discussion finding working algorithm would achieve limitation listed requirement num something asynchronous want stop file operation dira work num assume blindly rsync dira regular interval dira could contain million file directory terrabytes completely walking dira tree could take hour two requirement make really difficult asynchronous mean start working specific file dira might moved lot since appeared second limitation mean really need watch dira work atomic file operation notice current broken implementation num log file directory operation dira num using separate process read log repeat logged operation broken echo num dira file1 allow log reader process create file1 log write dira file1 action cp dira file1 file1 result ok echo num dira file2 mv dira file1 dira file3 mv dira file2 dira file1 rm dira file3 end result file1 contains num log reader process start working num file operation log write file2 action cp dira file2 file2 result failed dira file2 log rename file1 file3 action mv file1 file3 result ok log rename file2 file1 action mv file2 file1 result failed file2 log delete file3 action rm file3 result ok end result file another broken example echo num dira dir1 file1 mv dira dir1 dira dir2 log reader process start working num file operation log write file1 action cp dira dir1 file1 dir1 file1 result failed dira dir1 file1 log rename dir1 dir2 action mv dir1 dir2 result failed dira dir1 end result nothing