server responds request socket client function emit request function handle response server problem request sending response handling two unrelated function given server response x know whether response request x request would like make construct would ensure response x definitely answer request x also make return response x response question mostly general programming approach specific language construct preferably though answer would involve ruby tcp socket php far require socket def initialize config config config end def send conn send n num end def connect connect server begin conn tcpsocket open config server config port rescue interrupt rescue exception detail exception detail message detail backtrace join n retry end end def send get end def handle server case strip hello server say hello send hello num else end end def ready select conn stdin nil nil nil next ready ready num stdin stdin eof stdin get send elsif conn conn eof conn get handle server end end end end def msg time new put strftime h msg end end config hash server test server com port num conn new config conn connect conn begin conn rescue interrupt rescue exception detail conn exception detail message detail backtrace join n retry end