currently implementing network protocol protocol us quite complex extensive finite state machine pair event plus state mapped work set new state num valid state event combination num distinct function called refactored whole state machine logic away associating sending receiving let call service separate statemachine problem num function need access service example reset deadline timer could statemachine service access internals would introduce tight coupling albeit natural belong together could also leave class one would result huge since doubt first one running problem assume exists less canned solution found yet