matrix hamiltonian order l n x l n l n tmax rho table j l n j l n timing rho paralleltable j l n j l n hop transpose table j co j l table j sin j l integer identitymatrix l integer identitymatrix l n h sum fixedpoint arrayflatten tensorproduct hop tensorproduct n made code large time dependent differential equation initial value want compile using ndsolve code rho table rho j h j l n j l n timing fun h rho eq j j rho j eq paralleltable eq j l n j l n eqsopwo join thread thread rho fun eq flatten rho termsop rho flatten sol ndsolve eqsopwo diagonal rho tmax dependentvariables rho termsop maxsteps maxstepfraction method equationsimplification solve chop plot evaluate diagonal rho sol tmax plotrange