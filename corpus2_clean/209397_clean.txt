implemented application protocol stack move incoming stream upward several layer follows num copy tcp segment o buffer buffer num identifying record boundary split record buffer tab separated string copied deque deque rather vector immediately pop couple field front num copy deque vector record n presented without copying application wondering whether best stick clean architecture layering pay price whatever copying payload layer layer simple optimization people use customary use separate buffer separate layer something easily optimized away without dangerously compromising independence layer