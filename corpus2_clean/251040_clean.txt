state driven agent agent performs action based current state logic implemented use fsm change state depending agent perception perform action entering exiting state trying implement design entity component system ec architecture first thought implement fsm component containing current state rulebook system update fsm component current state depending rulebook system implement action entity modify component accordingly depending state fsm component sure correct ec implementation cleanly represent enter state exit state perform action behaviour sda implemented ec architecture