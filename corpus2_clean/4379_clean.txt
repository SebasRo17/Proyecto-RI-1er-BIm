consider following data satisfying answer former question part another issue occurred background list operation restriction fulfilled applying transpose total gatherby first data data thanks andy ross approach receive resembles x n x x u x z x z x z would like following u transform u residual u n calculate residual u divide n x n residual x residual x residual x z x z x z distribute residual period x n x result case data better understanding please consider following example example myfunction example example myfunction example example myfunction example myfunction detects peak within dataset kill replacing peak preceding sequence constant value residual see example example important myfunction return original list peak occurs list see example