trying write fairly general replacement rule pull expression independent variable integration outside integrate since simplify fullsimplify seem example try integrate f x log x r integrate q r v l h freeq r v r integrate q v l h return r f x f x log trace show correctly recognized log independent z pulled outside even though recognizes f x depends x incorrectly integration finally assembles result f x previously defined say sin x problem appear way write rule would correct circumstance