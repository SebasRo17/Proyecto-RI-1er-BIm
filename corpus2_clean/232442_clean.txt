work represents current state something akin shopping cart order stored 3rd party shopping api controller want able call myorder num order actually send message third party third party also need know several thing specific order like orderid loginid change lifetime application create myorder originally inject messagefactory know loginid called order pass along orderid controlling easy write another thread handle callback update order change successful informs order change failed problem testing order depends messagefactory need messagefactory actual message call setorderid example set complicated messagefactory mock additionally want kill every time mock return mock fairy dy solve problem keeping controller simple read question num law demeter factory pattern dependency injection help talk testing problem solution thought num somehow refactor require factory real object perhaps less factory messagesender num create testing implementation messagefactory inject pretty involved attempt sscce public order implement private final messagefactory factory private final layer private orderdata package private constructor called orderbuilder order orderbuilder builder orderdata initial factory builder getfactory layer builder original lot method like public getitemid getitemid return message placed outgoing network queue successfully block receipt though public boolean message newmessage factory key throw npe factory mock newmessage layer send newmessage interface get called asynchronously override public update update