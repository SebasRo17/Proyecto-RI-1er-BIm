use drupal num base cm tool one specific product something like erp created sort non drupal layer keep specific business would something like business would business specific layer glue connect basic drupal api need drupal drupal api concept repository basic retrieves something database form entity entity layer connected drupal since need access db query drupal num api whole business layer tested using phpunit num coverage trying test glue layer well unit repository value parameter order came conclusion would need mock drupal database access api would correct best approach wrap db query drupal could mocked test test repository