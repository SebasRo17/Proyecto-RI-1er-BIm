interesting problem partial solution feel guy come efficient solution sql table following structure unique id share unique id share holder price stock request purchase kept num num mean holder want buy num mean selling special record store calculated based complex computation value num num num based let u say bad neutral good want find give stock want buy purchase one got want person give good quality stock local cheapest price global best selling match person buy semi global stock best buying match formula rank seller num price num availability num quality would go idea created table join get info every match grouping acquire price cheapest