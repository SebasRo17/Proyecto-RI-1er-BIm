n number atom l umber atomic level ct xk ct xk conjugatetranspose xk fx xk fx xk fixedpoint arrayflatten xk gb k eb k rb k e l table kroneckerdelta l l l e l transpose e hop k g gb k ct eb k g eb k ct gb k rb k ct eb k eb k ct rb k integer identitymatrix l integer identitymatrix l n hn sum fx tensorproduct hop tensorproduct n prr integer prr fx tensorproduct transpose tensorproduct pee integer pee fx tensorproduct transpose tensorproduct prr integer prr fx tensorproduct tensorproduct pee integer pee fx tensorproduct tensorproduct hint p sum j sqrt e prr prr prr j prr j n j n hfinal hn hint p lfull x matrixq numericq sum r x r x r x e x e x e x prr prr pee pee n numerical value mhz n khz n g n exp tmax tmax tmax g n exp tmax tmax tmax e mhz n r khz n mhz g mhz tmax compile function h hfinal compile x complex real h x x h lfull x fun x matrixq numericq x mmu maxmemoryused sol ndsolve fun table j l n j l n tmax maxstepsize maxsteps mmu maxmemoryused mmu consider n ndsolve function working large memory problem please help issue