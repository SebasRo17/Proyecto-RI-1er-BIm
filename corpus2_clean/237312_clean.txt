consider mock software stack designed layered architecture mind basic example layered structured software stack every application layer decoupled api call memory handling library used throughout layer need copy allocate somehow affect memory bad use layered architecture pattern one pitfall one hand trying force pattern upon library call perhaps adding memory handling wrapper every application layer would create lot boilerplate hand letting layer library call create arbitrary entry point different layer seems contradict rationale behind layered architecture