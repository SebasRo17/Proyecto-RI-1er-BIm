writing routine following form try success b success retry success throw trivial extract either b routine simple structure allow retry without duplication currently allows n retries retries num success break else retries num b success break else throw retries num ugly ideal implies might want ever retry use simple way seeing context generated executing sql statement try update first entry update found insert command fails concurrency already created try update