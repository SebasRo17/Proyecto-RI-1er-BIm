thinking testability modular recently thought whether split synchronization part actual behavior part example app need access thread safe private unsigned state mutex sync public state num unsigned mutate lock guard mutex lock sync const unsigned old state state num old seems simple enough except locking actual stuff really related though whether good idea split synchronized private unsigned state public state num unsigned mutate const unsigned old state state num old private mutex sync public unsigned mutate lock guard mutex lock sync mutate would help unit testing awful pattern name called simple way generate wrapper c arbitrary call