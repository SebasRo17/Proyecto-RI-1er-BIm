want calculate hessian matrix function evaluated numerically far following f testing need numericalcalculus np number parameter f x z x z z numeric version c count evaluation f par numericq c f par construct symmetric hessian hessian par numericq module diag urt temp temp diagonal diag table nd f replacepart par temp temp par np upper right triangle urt table j nd nd f replacepart par temp j temp temp par temp par j np j np result table j diag j urt j urt j np j np seems work c hessian matrixform yield expected result number function evaluation appears rather large got c normal nd calculation improved thank answer comment