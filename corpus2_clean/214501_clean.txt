trying figure best way setup fsm also keep interface clean use ioc container use di let visit head first design pattern textbook example machine interface dispense best practice thrown exception invalid state add state even applicable guess portion confused could see simple example getting complex related question perform di state state machine state registered ioc container let suppose order service inventory service dependency might model look like hard time digesting actually inject dependency state guess could register state pas container around state