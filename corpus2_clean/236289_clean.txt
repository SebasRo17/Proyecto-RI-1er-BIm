working sock server application written c really know design nice way got sock v4 enter image description sure clear thing think easier explain look class exists wrapper server instance client connects wait request look var eventargs client tostring var buffer new byte num var task eventargs client buffer num buffer length await task task task delay timeout task timeout reached trace writeline format num timeout expired num m timeout eventargs client disconnect eventargs client buffer private client client byte request var client tostring var createinstance request invalid version trace writeline format num invalid version num request num version 0x04 could v4 client v5 private client client var client tostring trace writeline format num id num request num num ipaddress port id trace write format num id num trying num num ipaddress port id var new client new ipendpoint ipaddress port result trace writeline succes byte response trace writeline format num id num request num domain id response ipaddress else response client send response num response length var tunnel new client tunnel tunnel tunnel open trace writeline format num id num tunnel opened id else trace writeline failed byte response response client send response num response length request packet look like ver cmd port ip id num num num num num number amount octet num byte num bit design sock v5 complex num authentication method authentication gssapi username password client connects sends greeting message contains authentication id server response authentication choose 0xff say acceptable authentication protocol start different method client proxy sends connection request full documentation found wikipedia design application support v5 oop manner edit full source found github