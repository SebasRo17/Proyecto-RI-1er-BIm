interested finding computationally efficient way selecting tuples matrix certain property property interested want column sum f sum matrix tuple contain distinct element f x piecewise x code specifies property h x x x x x x x x x z z z z z z z z z piecewise f x z f x z f x z f x z f x z f x z f x z f x z f x z f x z f x z f x z f x z f x z f x z f x z f x z f x z however certain restriction sort matrix want collect triple code specifies restriction g x x x x x x x x x piecewise x x x x x x x x x x x x x x x x x x individual matrix triple must column sum distinct element moreover contain element trace equal sum symmetrical element w r main diagonal must w tuples select tuples tuples tr g w creates triple matrix q select w h q selects triple desired property however try apply method either larger matrix x rather x example larger tuples tuples code crash mathematica suspect w large computer memory example create tuples x element w cardinality general set n r n number matrix r size tuples drawn suspect much efficient way generating q much smaller w rather generating entirety w selecting would prefer construct element w one one check property need output matrix property fail meet discarded help would greatly appreciated