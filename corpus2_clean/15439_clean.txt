large set point trying identify point lie within certain distance point using data store vector pair point point result million vector seems map nearest set point unpacking array becomes ragged appears take memory end flatten array specific depth manually pack estimate fit memory closepointsvectors find point within unit point x return vector point x close point map point dataset generates many many vector minimal non working example data randomreal nearestfunction nearest data closepointsvectors x x nearestfunction x infinity let try small subset data smalltest flatten map closepointsvectors data absolutetiming null developer packedarrayq data true developer packedarrayq smalltest false bytecount smalltest packedsmalltest developer topackedarray smalltest developer packedarrayq packedsmalltest true bytecount packedsmalltest way reduce memory usage possibly keeping array packed whole time pad array zero go prevent becoming ragged tried take advantage compile appear work nearest