ugly bit essentially iteration structure meat action changing iteration stayed iteration constituted bulk least four case copying refactored putting level iteration probably another post later new considerably nicer least eye copy paste location however due infrastructure introduce refactor nested loop separate class ended num larger number locs discount extra infrastructure get num smaller compared original size sophisticated shorter may harder understand less programmer may still end shorter future reuse present question think worth good idea refactor loc count go