working refactoring legacy application implemented state pattern successfully shown following diagram state pattern uml see common behavior num state decided extract common refund parent abstract implemented refactoring common operation refactoring notice ship common num state cancelled neworder go another round extracting common behavior another parent refactoring problem need cancelled state extend num class time group refund ship together state permit num action fix note question mainly applying dry refactoring implement state pattern using php num open answer language