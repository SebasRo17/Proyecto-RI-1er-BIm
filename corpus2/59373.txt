I have defined several custom analytic functions. Here is the simplest example:               ln[x_, a_?NumericQ] := Piecewise[{{Log[x], Re[a] > 0}, {-Log[1/x], True}}]      Now I would like to let Mathematica know how to carry out derivatives on this: I need to make `D` and `Series` work on `ln` as if it were `Log`:               ln /: D[ln[f_, g_], x_] := D[Log[f], x];      Works wonderfully: ![enter image description here](http://i.stack.imgur.com/mafR8.png) But `Series` doesn't work because it is using `Derivative` instead of `D`. ![enter image description here](http://i.stack.imgur.com/pq3VH.png) So, now I try `TagSetDelayed` on `Derivative`: ![enter image description here](http://i.stack.imgur.com/lEy4E.png) But as you can see, it doesn't work because `ln` is too deep. What can I do to make `Series` work?