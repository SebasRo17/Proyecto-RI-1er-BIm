_NOTE: This is in reference to the question Iasked on Stack Overflow but was told to post this here_ I'm building a trading application that matches buyers/sellers that own subscription. Subscriptions have a certain quantity amount for a certain duration of time. There are 8 order types which are:   * Buy/sell subscription (can either be partially filled in regards to quantity or time)   * Buy/sell all quantity subscription (can only be partially filled in regards to time)   * Buy/sell all time subscription (can only be partially filled in regards to quantity)   * Buy/sell all quantity and time subscription (cannot be partially filled, all or nothing) Each user that fills the * * * # Example 1 Assuming all orders in this example can be partially filled in regards to quantity and time lets say User A places a buy order asking for 100 shares between 1/2/2014 - 1/3/2014 (dd/mm/yyyy). There are 4 sell orders currently in the order book   * User B is selling 25 shares between 1/1/2014 - 5/1/2014    * User C is selling 50 shares between 1/1/2014 - 15/2/2014    * User D is selling 70 shares between 10/2/2014 - 1/7/2014    * User E is selling 5 shares between 15/2/2014 - 25/2/2014 Which would look like               User A                 |--------------100-----------|     User B    |----------------------------25-----------------------|     User C    |-------------------50---|     User D                       |--------------70------------------|     User E                             |--5--|      After the matching is done each users orders in the order book would look like               User A                 |-25--|           |----5-----|     User B    |------25----|                            |----25-----|     User C    |------50----|     User D                                              |----70-----|     User E has no open orders      After all said and done the order book would look like:   * User A is buying 25 shares between 1/2/2014 - 10/2/2014   * User A is buying 5 shares between 15/2/2014 - 1/3/2014   * User B is selling 25 shares between 1/1/2014 - 1/2/2014   * User B is selling 25 shares between 1/3/2014 - 5/1/2014   * User C is selling 50 shares between 1/1/2014 - 1/2/2014   * User D is selling 70 shares between 1/3/2014 - 1/7/2014   * User E isn't selling anything # Example 2 This example is exactly the same except User B is of sell all quantity and time subscription type. In other words User B wants to sell his/her's entire position. After the matching is done each users orders in the order book would look like               User A                 |-50--|     |--25-|----30----|     User B    |----------------------------25-----------------------|     User C    |------50----|     User D                       |-20--|                |----70-----|     User E has no open orders      After all said and done the order book would look like:   * User A is buying 50 shares between 1/2/2014 - 10/2/2014   * User A is buying 25 shares between 15/2/2014 - 25/3/2014   * User A is buying 30 shares between 25/2/2014 - 1/3/2014   * User B is selling 25 shares between 1/1/2014 - 5/1/2014 (doesn't even match because this order doesn't allow partial filling)   * User C is selling 50 shares between 1/1/2014 - 1/2/2014   * User D is selling 70 shares between 15/2/2014 - 25/2/2014   * User D is selling 70 shares between 1/3/2014 - 1/7/2014   * User E isn't selling anything * * * # Process Another requirement is I need to be able to keep track of how the orders are filled in the database. When User A's buy order comes in it will first match to User B's which would result in:               User A                 |--------------75------------|     User B    |------25----|                            |----25-----|      Both of those states would need to be saved to the database. Once that is complete then User C's order is matched up, which would look like:               User A                 |-----25----|------75--------|     User B    |------25----|                            |----25-----|     User C    |------50----|      Keep going:               User A                 |--25-|     |-------5--------|     User B    |------25----|                            |----25-----|     User C    |------50----|     User D                                              |----70-----|      * * * # Question Is there any existing algorithm to do what I'm asking? **EDIT** : After some searching it sort of seems like I'm after an interval tree or a segment tree where I can sum up what's in the tree for a given time range. However I need to be able to store the modifications to the tree in a database with the start and dates. Are there any implementations out there of this done with LINQ or SQL? **EDIT 2:** In my first edit I thought it was an interval tree but now it looks more like bin packing algorithm