![enter image description here](http://i.stack.imgur.com/H2l9N.png)I have the following:               n = 3;     m = 5;     ww = RandomReal[{0, 0.1}, {n, n}];     uu = RandomReal[{0, 1}, {m, n}];     pp = RandomReal[{0, 1}, {n, n}];     ss = RandomInteger[{0, 5}, {m, n}];     Grid[{{"ww", "uu", "pp", "ss"}, {ww // TableForm, uu // TableForm,         pp // TableForm, ss // TableForm}}, Spacings -> {5, 2},       Dividers -> All]      where I would like to look at every element of matrix `ss` and produce a matrix `tt`, with zeroes at the locations in `ss` which have zeroes, and in all other positions do the following:               tt = (-1/Subscript[ww, m]) Log[(1 - uu)/(Subscript[pp, m - 1])],       where `Subscript[ww, m]` is the value at `index` of `ww` matrix and where `Subscript[pp, m - 1]` is the value at `index-1` of `pp` matrix. So for example if the first value ever read from matrix `ss` happens to be 2, then value taken from matrix `ww` would be from the row 2, but from `pp` would be from row 1. Also how to tell difference between a 0 as a valid value from within the matrix elements to end of matrix if I do not know the actual size of the matrix beforehand? Given the data as above, tt matrix would be like this: ![enter image description here](http://i.stack.imgur.com/hoL7h.png)