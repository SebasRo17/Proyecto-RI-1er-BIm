I have a set of coupled differential equations which represents the equation of motion of a particle in cylindrical coordinates with the following Hamiltonian: $$ H=\frac{1}{2m} \left( p_r^2 + \frac{p_\phi^2}{r^2} + p_z^2 \right) + c \sqrt{\frac{r^2}{4 a^2} + \frac{z^2}{a^2} }, $$ where a and c are some arbitrary constant. From Hamilton's equations: $$ \dot{q_i} = \frac{\partial H}{\partial p_i} \\\ \dot{p_i} = - \frac{\partial H}{\partial q_i}, $$ we get: $$ \dot{r} = \frac{p_r}{m} \\\ \dot{\phi} = \frac{p_\phi}{m r^2} \\\ \dot{z} = \frac{p_z}{m} \\\ \dot{p_r} = \frac{p_\phi^2}{m r^3} - \frac{c r}{4 a^2 \sqrt{\frac{r^2}{4 a^2} + \frac{z^2}{a^2} }} \\\ \dot{p_\phi} = 0 \\\ \dot{p_z} = - \frac{c z}{4 a^2 \sqrt{\frac{r^2}{4 a^2} + \frac{z^2}{a^2} }} $$               hamiltonianCylindrical[r_,phi_,z_,pr_,pPhi_,pz_,m_,a_,c_]:=1/(2 m) (pr^2+pPhi^2/r^2+pz^2) + c Sqrt[r^2/(4 a^2)+z^2/a^2]          cylindricalTrajectory[r0_, phi0_, z0_, pr0_, pPhi0_, pz0_, m_, a_, c_,steps_]:=NDSolve[       {        r'[t]==D[hamiltonianCylindrical[r[t],phi[t],z[t],pr[t],pPhi[t],pz[t],m,a,c],pr[t]],         phi'[t]==D[hamiltonianCylindrical[r[t],phi[t],z[t],pr[t],pPhi[t],pz[t],m,a,c],pPhi[t]],         z'[t]==D[hamiltonianCylindrical[r[t],phi[t],z[t],pr[t],pPhi[t],pz[t],m,a,c],pz[t]],         pr'[t]==-D[hamiltonianCylindrical[r[t],phi[t],z[t],pr[t],pPhi[t],pz[t],m,a,c],r[t]],         pPhi'[t]==-D[hamiltonianCylindrical[r[t],phi[t],z[t],pr[t],pPhi[t],pz[t],m,a,c],phi[t]],         pz'[t]==-D[hamiltonianCylindrical[r[t],phi[t],z[t],pr[t],pPhi[t],pz[t],m,a,c],z[t]],        r[0]==r0,        phi[0]==phi0,        z[0]==z0,        pr[0]==pr0,        pPhi[0]==pPhi0,        pz[0]==pz0       },       {r[t], phi[t], z[t], pr[t], pPhi[t], pz[t]},       {t, 0, steps},       WorkingPrecision -> 20,       MaxSteps -> \[Infinity]     ]              For example, if I run the following:               Plot[       Evaluate[r[t]/.cylindricalTrajectory[1, 0, 2, 1, 0, 1, 1, 1, 1, 500]],       {t,0,500}     ]      I can see that r becomes negative, which is not possible in cylindrical coordinates. Therefore, I wanted to know how I can solve the set of differential equation with r>=0. **Update** I noticed something weird is happening (which I have seen before):               Plot[       Evaluate[r[t] /. cylindricalTrajectory[1, 0, 2, 1, 1, 1, 1, 1, 1, 1000]],       {t, 0, 1000},       ImageSize -> Large     ]      ![enter image description here](http://i.stack.imgur.com/phsc2.jpg) At around t=500, r(t) behaves unexpectedly. However, if I only plot from t=0 to t=600, the "hiccups" at t=500 disappear. Another question I have is how do I convert from Cartesian to Cylindrical, if I am correct, the following should be the transformation: $$ r = \sqrt{x^2 + y^2} \\\ \phi = arctan \left( \frac{y}{x} \right) \\\ z=z \\\ p_r = p_x cos \phi + p_y sin \phi \\\ p_\phi = m (x p_y - y p_x) \\\ p_z = p_z $$ The one I am not quite sure is $p_r$.