I need to generate a very large sparse block matrix, with blocks consisting only of ones along the diagonal. I have tried several ways of doing this, but I seem to always run out of memory. The fastest way of doing this that I've come up with so far is as follows: (typically, I will need `n` to be at least 2500 and m of the order 50).               tmp= SparseArray[{}, {n,n}, 1];          SparseArray@      ArrayFlatten@       Table[If[i == j, tmp, 0], {i, m}, {j, m}]      Example when n=2, m=4: ![Matrix](http://i.stack.imgur.com/PIpvo.png) The problem with this construction is that `ArrayFlatten` for some reason converts the result to a normal matrix, and I run out of memory. That is, when it works, this code computes the end result very quickly and the result does not take up much memory. At some specific number however, it suddenly crashes as the intermediate `ArrayFlatten` step clogs up the memory. Any help will be greatly appreciated!