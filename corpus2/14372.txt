First I define an entry of `UpValues` overloading `D[]` for expressions with head `ftest`:               ftest /: D[ftest[aaa_, bbb_], r] := ftest[D[aaa, r], D[bbb, r]]      When I try:               D[ftest[r, r^2], r]      the result is as I expect it to be: > ftest[1, 2 r] However, when I try:               D[(r + ftest[r, r^2]), r]      Mathematica gives not the result I expect: > 1 + 2*r*Derivative[0, 1][ftest][r, r^2] + Derivative[1, 0][ftest][r, r^2] **edit** The result I expect is: > 1 + ftest[1, 2 r] (this clarification was suggested by Mr.Wizard, thanks!) **end edit** **How should I understand this?** **How can this be fixed?** * * * I tried               TreeForm@Unevaluated@Unevaluated@D[(r + ftest[r, r^2]), r]      and understand the result: ![img_1 for question on overloading D\[\] ](http://i.stack.imgur.com/SVA0m.jpg) I also tried               TreeForm@Unevaluated@Unevaluated@D[(r + ftest[r, r^2]), r]      and I don't understand what does Mathematica do in the meantime to produce this result: ![img_2 for question on overloading D\[\] ](http://i.stack.imgur.com/tiXSX.jpg)