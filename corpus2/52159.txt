This question is related to the question I posted here. In that question, I thought I have simplified my original problem into an equivalent concise version, but I found that it is not. So I decided to open this question. The goal is the same that I want to define a function `hhpar` that will differentiate `hh` with respect to x, while I changed the rule function as follows:               Clear[rule];     rulelist = {{tt -> 1, zz -> 1}, {tt -> 1, zz -> 2}, {tt -> 2,          zz -> 1}, {tt -> 2, zz -> 2}};     rule[i_] := rulelist[[i]];      The `hh` function is               Clear[hh];     hh[x_, y_, i_] := {{tt, x + Sin[x]},{y, zz}}/.rule[i];      As suggested by Szabolcs, to defined `hhpar` as               hhpar[x_,y_,i_]:=Derivative[1, 0, 0][hh][x, y, i]      will solve my former question. But it didn't work in current problem because it only gives ![result](http://i.stack.imgur.com/XW6UT.png) **Using`Trace`, I figure out that the problem is due to the failure of rule replacement before differentiation.** But how would I define `hhpar` now to solve the problem?