I want to simplify my function `f1` to `f2`, but `f2` can't be compiled. How can I make it compilable?               f1 = Compile[{{arr, _Real, 2}},        Module[{a, b, c, d}, {a, b, c, d} = arr;         {{a, (a + b)/2, (a + c)/2, (a + d)/2}, {(a + b)/2, b, (b + c)/2, (           b + d)/2}, {(a + c)/2, (b + c)/2, c, (c + d)/2}, {(a + d)/2, (           b + d)/2, (c + d)/2, d}}         ], RuntimeAttributes -> {Listable}];          v = {{{0, 0, .6}, {-.3, -.5, -.2}, {-.3, .5, -.2}, {.6, 0, -.2}}};     n = 3;     p = Nest[f1, v, n]~Flatten~n;     Graphics3D[Tetrahedron /@ p]               f2 = Compile[{{arr, _Real, 2}},        Module[{a, b, c, d}, {a, b, c, d} = arr;         With[{t = Evaluate@Map[Mean, Partition[Tuples[{a, b, c, d}, 2], 4], {2}]},          t          ]         ], RuntimeAttributes -> {Listable}];      ![enter image description here](http://i.stack.imgur.com/w2mH7.png)