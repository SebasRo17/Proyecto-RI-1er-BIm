The standard function DiagonalMatrix cannot be compiled, so I tried writing my own:               diagMat = Compile[{{vec, _Real, 1}},                       Module[{size = Length[vec], matr},                              matr = Table[0, {size}, {size}];                              Do[matr[[i, i]] = vec[[i]], {i, size}];                              matr]     ];      While this function works, it does not compile. (I check this by doing Export["test.c",diagMat] , is there a simpler way to do this? ) It gives the error message: > CCodeGenerate::wmreq: The expression > Function[{vec,iCompile$67,matrCompile$68},Block[{i=iCompile$67,matr=matrCompile$68},{matr[[i,i]]=vec[[i]],i,matr}]] > requires Mathematica to be evaluated. The function will be generated but can > be expected to fail with a nonzero error code when executed. >> I'm not sure what's wrong here, as all the functions I use are compilable. Thanks